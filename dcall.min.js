function GetWorkDescription(e){let t="",n={RFQ:"Right Front Quarter",RFV:"Right Front Vent",RFD:"Right Front Door",RRD:"Rear Right Door",RRV:"Rear Right Vent",RRQ:"Rear Right Quarter",WS:"Windscreen",RG:"Sunroof",RL:"Rearlight",LFQ:"Left Front Quarter",LFV:"Left Front Vent",LFD:"Left Front Door",LRD:"Left Rear Door",LRV:"Left Rear Vent",LRQ:"Left Rear Quarter",RP:"",X:"",MLD:"",TINT:""};const o=e.match(/(RFQ|RFV|RFD|RRD|RRV|RRQ|WS|RG|RL|LFQ|LFV|LFD|LRD|LRV|LRQ|RP|X|MLD|TINT)/gi);return o&&(t=o.map((e=>n[e.toUpperCase()])).join(", ")),t=t.replace(/\.|,/g,""),t}function ShowCustomMenu(e){"Note"==e?(Doc.Elements.CommMenu.style.display="none",Doc.Elements.NoteMenu.style.display="block",Doc.Elements.MenuContainer.style.display="flex",Doc.Elements.MenuContainer.style.left=event.pageX+"px",Doc.Elements.MenuContainer.style.top=event.pageY+"px"):"Comm"==e&&(Doc.Elements.NoteMenu.style.display="none",Doc.Elements.CommMenu.style.display="block",Doc.Elements.MenuContainer.style.display="flex",Doc.Elements.MenuContainer.style.left=event.pageX+"px",Doc.Elements.MenuContainer.style.top=event.pageY+"px")}function HideCustomMenu(){"none"!=Doc.Elements.MenuContainer.style.display&&(Doc.Elements.MenuContainer.style.display="none")}function ProcessNotes(){let e,t,n=Doc.Elements.NoteTab.parentNode,o="Loading";n.id="dnote";var l=setInterval((function(){let i=!1,a=null,c=!1,r=!1;if(null==n.querySelector(".t-icon"))var s=setInterval((function(){null!==n.querySelector(".t-icon")&&(i=!0,a=n.querySelector(".t-icon"),clearInterval(s))}),300);else i=!0,a=n.querySelector(".t-icon");if(null!==a)if(a.classList.contains("t-loading"))var d=setInterval((function(){0==a.classList.contains("t-loading")&&(c=!0,clearInterval(d))}),500);else c=!0;if(1==i&&1==c&&(r=!0),1==r){for(;t=Doc.Elements.NoteGrid.pop();)if(t.textContent.match("Branch"))for(var m=0;m<t.childNodes.length;++m)switch(t.childNodes[m].nodeType){case Node.TEXT_NODE:t.childNodes[m].textContent.match("Branch")&&t.innerHTML.includes("(Branch)")&&(e=t.parentNode,e.id="bnote"),t.childNodes[m].textContent.match(Doc.User)&&t.innerHTML.includes(Doc.User)&&(e=t.parentNode,e.id="rnote");break;case Node.ELEMENT_NODE:Doc.Elements.NoteGrid.push(t.childNodes[m])}clearInterval(l),o="Processed"}}),3e3)}function ProcessWhatsapp(){"none"==Doc.Elements.WhatsappField.style.display&&""!==Doc.Client.Cell&&(Doc.Elements.WhatsappLink.href="https://web.whatsapp.com/send/?phone=27"+Doc.Client.Cell.substr(1),Doc.Elements.WhatsappField.style="display: block; background-color: rgb(217 217 217)")}function ProcessAuthMail(e){let t=0;Array.from(Doc.Elements.ItemsGrid).forEach((function(e){"FY20000"!=e.innerHTML&&"FY1000000 "!=e.innerHTML&&"FY2000000"!=e.innerHTML||(t=1)})),1==t?(Doc.Elements.AuthMailInquiry.style="display: block; background-color: rgb(217 217 217)",Doc.Elements.AuthMailLink.href="mailto:"+e+"?Subject=REF%20"+Doc.Claim.REF+"&Body=Good%20day.%0AI%20hope%20you%20are%20well.%0A%0APlease%20find%20attached%20a%20FY%20quotation%20for%20pricing%20and%20authorisation.%0AThe%20quotation%20is%20also%20uploaded%20on%20the%20claim%20comms%20for%20your%20reference."):0==t&&(Doc.Elements.AuthMailInquiry.style="display: none",Doc.Elements.AuthMailLink.href="#")}function ProcessInquiryMail(){""!==Doc.Vehicle.VIN&&""!==Doc.Vehicle.Make&&(Doc.Elements.InquiryMailField.style="display: block; background-color: rgb(217 217 217)",Doc.Elements.InquiryMailLink.href=GetBuyoutsLink(_BuyOutsAddress,_DealerAddresses))}function JScopyText(e){navigator.clipboard.writeText(window.JSSelect).then((()=>{delete window.JSSelect})).catch((e=>{console.log(e)}))}function JSPasteText(){let e;if("none"!==Doc.Elements.NoteWin.style.display?e=Doc.Elements.NoteBox:"none"!==Doc.Elements.SMSWin.style.display&&(e=Doc.Elements.CommsBox),e.selectionStart||"0"==e.selectionStart){var t=e.selectionStart,n=e.selectionEnd;navigator.clipboard.readText().then((o=>e.value=e.value.substring(0,t)+o+e.value.substring(n,e.value.length)))}else navigator.clipboard.readText().then((t=>e.value+=t))}function JSChangeState(){Doc.JSMenu.Status.value="New",alert("Status changed to new.\nSave to apply the new status.")}function loadJsQR(e){const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js",t.onload=e,document.head.appendChild(t)}function ProcessTelematix(e){Doc.Telematix.FieldJS.style.display="block",loadJsQR((()=>{Doc.Telematix.HelperBtn.onclick=()=>{Doc.Telematix.QRFormModal.style.display="block"},Doc.Telematix.QRSubmitBtn.onclick=async()=>{Doc.Telematix.QRFormModal.style.display="none";const t=async e=>new Promise((t=>{const n=e.files[0];if(!n)return t("");const o=new FileReader;o.onload=e=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const o=e.getContext("2d");o.drawImage(n,0,0);const l=o.getImageData(0,0,e.width,e.height),i=jsQR(l.data,e.width,e.height);t(i?i.data:"[Invalid QR]")},n.src=e.target.result},o.readAsDataURL(n)})),n=await t(Doc.Telematix.QRFieldA),o=await t(Doc.Telematix.QRFieldB),l=await t(Doc.Telematix.QRFieldC),i=new Date,a=String(i.getDate()).padStart(2,"0"),c=String(i.getMonth()+1).padStart(2,"0")+"/"+a+"/"+i.getFullYear(),r=encodeURIComponent("Branch: "+_Branch+"\n"+`Vehicle Make: ${Doc.Vehicle.Make}\n`+`Vehicle Model: ${Doc.Vehicle.Model}\n`+`Vehicle Year: ${Doc.Vehicle.YModel}\n`+`Vehicle Reg: ${Doc.Vehicle.Reg}\n`+`Vehicle VIN: ${Doc.Vehicle.VIN}\n`+`Policy No: ${Doc.Claim.Policy}\n`+`Client Name: ${Doc.Client.Name}\n`+`Client Surname: ${Doc.Client.Surname}\n`+`Installation Date: ${c}\n`+`SN: ${n}\n`+`IMEI: ${o}\n`+`PANIC: ${l}`),s=`https://web.whatsapp.com/send/?phone=27${e}&text=${r}`;window.open(s,"_blank")}}))}function ToggleHamburger(e){Doc.Elements.Hamburger.classList.toggle("active"),Doc.Elements.HamburgerMenu.classList.toggle("active"),Doc.Elements.Hamburger.classList.contains("active")&&(ProcessWhatsapp(),Doc.Elements.PrintClaimLink.href="https://"+Doc.URL.hostname+"/DPSWeb2/Report/_claim/"+Doc.Claim.REF+"?reporttype=claim",Doc.Elements.PrintClaimReport.href="https://"+Doc.URL.hostname+"/DPSWeb2/Report/_claim/"+Doc.Claim.REF+"?reporttype=worksorder",ProcessAuthMail(e),ProcessInquiryMail())}function GetBuyoutsLink(e,t){let n="",o=e,l="REF "+Doc.Claim.REF,i="Good day.\n\nI hope you are well.\nPlease quote me on glass for the following positoins: "+Doc.Vehicle.WorkDescription+"\nIt is for a "+Doc.Vehicle.Make+" with VIN: "+Doc.Vehicle.VIN+"\n\nThanx in advance.",a="";return n=t[Doc.Vehicle.Make],a=n==o?"mailto:"+n+"?Subject="+encodeURI(l)+"&Body="+encodeURI(i):"mailto:"+n+"?cc="+o+"&Subject="+encodeURI(l)+"&Body="+encodeURI(i),a}function GetComms(e,t){Doc.Elements.CommsBox.value+=_COMMSMsg[e][t]}function GetMSG(e,t,n){Doc.Elements.NoteBox.value+=MSG[e][t][n]}Doc={Elements:{NoteBox:document.getElementById("NewNote"),NoteMenu:document.getElementById("NoteMenuList"),CommsBox:document.getElementById("NewSMSNote"),CommMenu:document.getElementById("CommMenuList"),Hamburger:document.getElementById("jshamburger"),HamburgerMenu:document.getElementById("burgermenuJS"),HamburgerContainer:document.getElementById("JSburgerM"),MenuContainer:document.getElementById("MenuContainer"),NoteGrid:[document.querySelector("#NoteGrid")],NoteTab:document.querySelector("#NoteGrid"),WhatsappField:document.getElementById("JSWhatsapp"),WhatsappLink:document.getElementById("WhatsappLink"),ItemsGrid:document.querySelectorAll(".CellNoLines"),AuthMailInquiry:document.getElementById("JSAuthInquiry"),AuthMailLink:document.getElementById("EmailAuthLink"),InquiryMailField:document.getElementById("JSMailInquiry"),InquiryMailLink:document.getElementById("EmailInquiryLink"),NoteWin:document.getElementById("NoteWin"),PrintClaimLink:document.getElementById("CLaimLink"),SMSWin:document.getElementById("SmsWin"),PrintClaimReport:document.getElementById("ReportLink")},Client:{Cell:document.getElementById("ClientCell").value,Name:document.getElementById("ClientName").value,Surname:document.getElementById("ClientSurname").value},Claim:{REF:window.location.pathname.replace("/DPSWeb2/Branch/Claims/Edit/",""),Type:document.getElementById("GlassType").value,Policy:document.getElementById("PolicyNumber").value},Telematix:{FieldJS:document.getElementById("TelematiXJS"),HelperBtn:document.getElementById("qrHelperBtn"),QRFormModal:document.getElementById("qrFormModal"),QRSubmitBtn:document.getElementById("submitQRs"),QRFieldA:document.getElementById("qr1"),QRFieldB:document.getElementById("qr2"),QRFieldC:document.getElementById("qr3")},Vehicle:{VIN:document.getElementById("VIN").value,Make:document.getElementById("VehicleMakeId-input").value,Model:document.getElementById("VehicleModelId-input").value,YModel:document.getElementById("txtVehicleManufacYear").value,WorkDescription:GetWorkDescription(document.getElementById("WorkDescription").value),Reg:document.getElementById("VehicleReg").value},JSMenu:{Status:document.getElementById("Status"),jsbtn:document.getElementById("JSStateChange")},User:document.querySelector("HEADER > div:nth-of-type(3)").innerHTML.split("\n")[2],URL:window.location.href},Doc.Elements.NoteBox.addEventListener("contextmenu",(e=>{e.preventDefault(),""!==window.document.getSelection().toString()&&(window.JSSelect=window.document.getSelection().toString()),ShowCustomMenu("Note")})),Doc.Elements.CommsBox.addEventListener("contextmenu",(e=>{e.preventDefault(),""!==window.document.getSelection().toString()&&(window.JSSelect=window.document.getSelection().toString()),ShowCustomMenu("Comm")})),document.addEventListener("click",(e=>{if(HideCustomMenu(),Doc.Elements.Hamburger.classList.contains("active")){t=e.target.classList,n="JSBMO",t.contains(n)||ToggleHamburger(_AuthEmailAddress)}var t,n})),"Invalid"==Doc.JSMenu.Status.value&&(Doc.JSMenu.jsbtn.style.display="block"),"Unit"==Doc.Claim.Type&&ProcessTelematix(_Telematic_Contact),Doc.Elements.HamburgerContainer.style.display="flex",ProcessNotes();